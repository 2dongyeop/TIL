# 동기화 도구들

<br/>

> 🌱 *협력적 프로세스란?*
>
>→ 시스템 내에서 실행 중인 다른 프로세스의 실행에 영향을 주거나 받는 프로세스!
>
>→ 논리 주소 공간을 공유하거나, 공유 메모리 또는 메시지 전달을 통해 데이터를 공유한다.

<br/>

<br/>

## 💡 배경 

> 프로세스가 병행 또는 병렬로 실행될 때 **공유 데이터의 무결성**에 어떤 문제를 일으키는지에 관해 알아보자!
> 

<br/>

<br/>

- 유한 버퍼 문제로 가정해보자.
    - 동시에 최대 `BUFFER_SIZE - 1` 개 까지만 버퍼에 저장할 수 있다.

<br/>

<br/>

- 첫번째 방법 : `count` 에 버퍼에 있는 개수를 저장하자.
    - 생산자 코드
        
        ```java
        while (true) {
        		
        		while (count == BUFFER_SIZE) ;
        
        		buffer[in] = next_produced;
        		in = (in + 1) % BUFFER_SIZE;
        		count++;
        }
        ```
    
    <br/>
    
    - 소비자 코드
        
        ```java
        while (true) {
        
        		while (count == 0) ;
        
        		next_consumed = buffer[out];
        		out = (out + 1) % BUFFER_SIZE;
        		count--;
        }
        ```
        

<br/>

<br/>

- 결과
  - 첫번째 방식은 병행으로 실행 시 올바르게 동작하지 않는다.
  
    <img src="https://github.com/2dongyeop/TIL/blob/main/OS/image/buffer-count.png" width = 600/>

<br/>

<br/>


> 🌱 **경쟁 상황**(race condition)이란?
>
>→ 여러 프로세스가 동일한 자료에 접근하여 조작하고, 그 실행 결과가 접근이 발생한 특정 순서에 의존하는 상황을 말한다. 이를 피하기 위해 **동기화**는 필수적이다.

<br/>

<br/>

## 💡 임계구역 문제

- 프로세스 동기화에 관한 논의는 **임계구역 문제**라고 불리는 문제부터 시작한다.
    - **임계구역**이란, 적어도 하나 이상의 **다른 프로세스와 공유하는 데이터에 접근하고 갱신하는 구간**이다.
    - ***이때, 한 프로세스가 자신의 임계구역에서 수행하는 동안 다른 프로세스는 임계구역에 들어갈 수 없다.***

<br/>

<br/>

<img src="https://github.com/2dongyeop/TIL/blob/main/OS/image/critical-section-process.png" width = 600/>

- 임계구역의 구성
    - 진입 구역(`entry section`)
        - 자신의 임계구역으로 진입하기 위해 진입 허가를 요청하는 부분이다.
    - 퇴출 구역(`exit section`)
        - 임계구역이 끝난 뒤 부분을 말한다.
    - 나머지 구역(`remainder section`)

<br/>

<br/>

- 임계구역에 대한 해결안은 아래 3가지 요구 조건을 충족해야 한다.
    1. **상호 배제(mutual exclusion)**
        1. 한 프로세스가 임계구역에서 실행되면, 다른 프로세스는 임계구역에서 실행될 수 없다.
    2. **진행(progress)**
        1. 자기의 임계구역에서 실행되는 프로세스가 없고, 임계구역에 진입하려는 프로세스가 있다면?
        2. 나머지 구역에서 실행중이지 않은 프로세스들만 다음에 누가 임계구역으로 진입할지 참여한다.
        3. 또한 이 선택은 무한정 연기될 수 없다.
    3. **한정된 대기(bounded waiting)**
        1. 프로세스가 임계구경게 진입하려는 요청을 한 후부터 허용될 때까지, 다른 프로세스가 임계구역에 진입하도록 허용되는 횟수에는 한계가 있어야 한다.

<br/>

<br/>

- 단일 코어 환경에서의 임계구역 문제
    - 공유 변수를 수정하는 동안 인터럽트를 막는다면? → 선점없이 순차적 수행되도록하여 간단히 해결!
    - ***단, 이는 다중 처리기 환경에서는 실현할 수 없다.***
        1. 메시지가 모든 프로세서에 전달 후 다중 처리기에서 인터럽트를 비활성화 → 많은 시간 소요
        2. 메시지 전달이 임계구역으로의 진입을 지연시키고, 시스템 효율성을 떨어뜨림.

<br/>

<br/>

> 운영체제 내에서 임계구역을 다루기 위해 사용되는 일반적인 두 가지 접근법
> 
1. **선점형 커널**
    1. 프로세스가 커널 모드에서 수행되는 동안 선점되는 것을 허용한다.
    2. 경쟁 조건이 발생하지 않도록 보장하기 위해 신중하게 설계를 해야 한다.
2. **비선점형 커널**
    1. 커널 모드에서 수행되는 프로세스의 선점을 허용하지 않는다.
    2. 선점이 없으므로, 경쟁 조건을 염려할 필요가 없다.


<br/>

<br/>
