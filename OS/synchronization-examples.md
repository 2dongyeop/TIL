# ë™ê¸°í™” ì˜ˆì œ
## ğŸ’¡Â ê³ ì „ì ì¸ ë™ê¸°í™” ë¬¸ì œë“¤

### ìœ í•œ ë²„í¼ ë¬¸ì œ

> ì´ ë¬¸ì œëŠ” ì¼ë°˜ì ìœ¼ë¡œ ë™ê¸°í™” í”„ë¦¬ë¯¸í‹°ë¸Œë“¤ì˜ ëŠ¥ë ¥ì„ ì„¤ëª…í•˜ê¸° ìœ„í•´ ì‚¬ìš©ëœë‹¤.
ì–´ëŠ íŠ¹ì • êµ¬í˜„ì— êµ­í•œë¨ ì—†ì´ ì´ í•´ê²° ë°©ë²•ì˜ ì¼ë°˜ì ì¸ êµ¬ì¡°ë¥¼ ì œì‹œí•œë‹¤.
> 

<br/>

<br/>

- ì†Œë¹„ì - ìƒì‚°ìê°€ ì•„ë˜ì™€ ê°™ì€ ìë£Œêµ¬ì¡°ë¥¼ ê³µìœ í•œë‹¤ê³  ê°€ì •.
    
    ```java
    int n;
    semaphore mutex = 1;
    semaphore empty = n;
    semaphore full = 0;
    ```
    
    - ë‚´ìš© ì„¤ëª…
        - nê°œì˜ ë²„í¼ë¡œ êµ¬ì„±ëœ í’€ì´ ìˆê³ , ê° ë²„í¼ëŠ” í•œ í•­ëª©ì„ ì €ì¥í•  ìˆ˜ ìˆë‹¤.
        - mutex ì´ì§„ ì„¸ë§ˆí¬ëŠ” ë²„í¼ í’€ì— ì ‘ê·¼í•˜ê¸° ìœ„í•´ ìƒí˜¸ ë°°ì œ ê¸°ëŠ¥ì„ ì œê³µí•˜ë©°, 1ë¡œ ì´ˆê¸°í™”
            - ë”°ë¼ì„œ `empty`ì™€ `full`ë¡œ ê¸°ë¡í•œë‹¤.

<br/>

<br/>

- ìƒì‚°ì ì½”ë“œ
    
    ```java
    while (true) {
    		/* produce an item 
    		in next_produced */
    		...
    		wait(empty);
    		wait(mutex);
    		...
    
    		/* add next_produced 
    		to the buffer */
    		...
    		signal(mutex);
    		signal(full);
    }
    ```
    
<br/>

<br/>

- ì†Œë¹„ì ì½”ë“œ
    
    ```java
    while (true) {
    		wait(full);
    		wait(mutex);
    		...		
    		/* remove an item from 
    		buffer to next_consumed */
    		
    		...
    		signal(mutex);
    		signal(empty);
    		...
    		/* consume the item 
    		in next_consumed */
    }
    ```
    
<br/>

<br/>


### Reader-Writers ë¬¸ì œ

> `readers-writers` ë¬¸ì œë€?
> 
> - writerê°€ ì“°ê¸° ì‘ì—… ë™ì•ˆì— ê³µìœ  ë°ì´í„°ë² ì´ìŠ¤ì— ëŒ€í•´ ë°°íƒ€ì  ì ‘ê·¼ ê¶Œí•œì„ ê°€ì§€ê²Œ í•  í•„ìš”ê°€ ìˆë‹¤.
> - ì´ë•Œ, ì´ ë™ê¸°í™” ë¬¸ì œë¥¼ readers-writers ë¬¸ì œë¼ê³  í•œë‹¤.

<br/>

<br/>

> `readers-writers` ë¬¸ì œì—ëŠ” ì—¬ëŸ¬ ê°€ì§€ ë³€í˜•ë“¤ì´ ìˆë‹¤.
> 
> 1. Writerê°€ ê³µìœ  ê°ì²´ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” í—ˆê°€ë¥¼ ì–»ì§€ ëª»í–ˆë‹¤ë©´, ì–´ëŠ Readerë„ ê¸°ë‹¤ë¦¬ê²Œ í•´ì„œëŠ” ì•ˆëœë‹¤.
> 2. Writerê°€ ì¤€ë¹„ë˜ë©´ ê°€ëŠ¥í•œ í•œ ë¹¨ë¦¬ ì“°ê¸°ë¥¼ ìˆ˜í–‰í•  ê²ƒì„ ìš”êµ¬í•œë‹¤.

<br/>

<br/>

- ìš°ë¦¬ëŠ” ìœ„ ë¬¸ì œì— ëŒ€í•˜ í•´ê²°ì•ˆì´ ê¸°ì•„ ìƒíƒœë¥¼ ë‚³ì„ ìˆ˜ ìˆìŒì„ ìœ ì˜í•´ì•¼ í•œë‹¤.
    - ì²« ë²ˆì§¸ ê²½ìš°ì—ëŠ” Writerê°€ ê¸°ì•„ ìƒíƒœì— ë¹ ì§ˆ ìˆ˜ ìˆê³ ,
    - ë‘ ë²ˆì§¸ ê²½ìš°ì—ëŠ” Readerê°€ ê¸°ì•„ ìƒíƒœì— ë¹ ì§ˆ ìˆ˜ ìˆë‹¤.

<br/>

<br/>

- ì²« ë²ˆì§¸ Readers-Writers ë¬¸ì œì— ëŒ€í•œ í•´ê²°ì•ˆ
    - Reader í”„ë¡œì„¸ìŠ¤ëŠ” ì•„ë˜ì˜ ìë£Œêµ¬ì¡°ë¥¼ ê³µìœ í•œë‹¤ê³  ê°€ì •.
        
        ```c
        semaphore rw_mutex = 1;
        semaphore mutex = 1;
        int read_count = 0;
        ```
        
        - `mutex` ì„¸ë§ˆí¬ : read_countë¥¼ ê°±ì‹ í•  ë•Œ ìƒí˜¸ ë°°ì œë¥¼ ë³´ì¥í•˜ê¸° ìœ„í•¨
        - `rw_mutex` : writerë“¤ì„ ìœ„í•œ ìƒí˜¸ ë°°ì œ ì„¸ë§ˆí¬

<br/>

<br/>

- Writer í”„ë¡œì„¸ìŠ¤ì˜ êµ¬ì¡°
    
    ```c
    while (true) {
    		wait(rw_mutex);
    		...
    		/* writing is performed */
    		...
    		signal(rw_metex);
    }
    ```
    
<br/>

<br/>

- Reader í”„ë¡œì„¸ìŠ¤ì˜ êµ¬ì¡°
    
    ```c
    while (true) {
    		wait(mutex);
    		read_count++;
    		if (read_count == 1)
    				wait(rw_mutex);
    		signal(mutex);
    
    		...
    		/* reading is performed */
    		...
    		wait(mutex);
    		read_count--;
    		if (read_count == 0)
    				signal(rw_mutex);
    		signal(mutex);
    }
    ```
    

<br/>

<br/>

> `Readers-writers` ë¬¸ì œì™€ ê·¸ì˜ í•´ê²°ì•ˆë“¤ì€ ì¼ë°˜í™”ë˜ì–´ **read-writer ë½**ì„ ì œê³µí•˜ëŠ” ì‹œìŠ¤í…œë“¤ì´ ìˆë‹¤.
> 
> - ë½ì„ íšë“í•  ë•Œì—ëŠ” ì½ê¸°ì¸ì§€ ì“°ê¸°ì¸ì§€ì˜ ëª¨ë“œë¥¼ ì§€ì •í•´ì•¼ë§Œ í•œë‹¤.
> - í”„ë¡œì„¸ìŠ¤ê°€ ê³µìœ  ë°ì´í„°ë¥¼ ì½ê¸°ë§Œ ì›í•œë‹¤ë©´?
>     - ì½ê¸° ëª¨ë“œì˜ ë½ì„ ìš”ì²­í•œë‹¤.

<br/>

<br/>

> `Readers-writer` ë½ì€ ë‹¤ìŒê³¼ ê°™ì€ ìƒí™©ì—ì„œ ê°€ì¥ ìœ ìš©í•˜ë‹¤.
> 
> - ê³µìœ  ë°ì´í„°ë¥¼ ì½ê¸°ë§Œ í•˜ëŠ” í”„ë¡œì„¸ìŠ¤ì™€ ì“°ê¸°ë§Œ í•˜ëŠ” ìŠ¤ë ˆë“œë¥¼ ì‹ë³„í•˜ê¸° ì‰¬ìš´ ì‘ìš©
> - Writerë³´ë‹¤ readerì˜ ê°œìˆ˜ê°€ ë§ì€ ì‘ìš©.

<br/>

<br/>

### ì‹ì‚¬í•˜ëŠ” ì² í•™ìë“¤ ë¬¸ì œ

<img src="https://github.com/2dongyeop/TIL/blob/main/OS/image/dining-philosophers.png" width = 600/>

<br/>

<br/>

> ì‹ì‚¬í•˜ëŠ” ì² í•™ìë“¤ ë¬¸ì œëŠ” **ê³ ì „ì ì¸ ë™ê¸°í™” ë¬¸ì œ**ë¡œ ê°„ì£¼ëœë‹¤.
ë§ì€ ë¬¸ì œì˜ í•œ ì˜ˆì‹œë¡œ, êµì°© ìƒíƒœì™€ ê¸°ì•„ë¥¼ ë°œìƒì‹œí‚¤ì§€ ì•Šê³  ì—¬ëŸ¬ ìŠ¤ë ˆë“œì—ê²Œ ì—¬ëŸ¬ ìì›ì„ í• ë‹¹í•¨ì„ ì˜ë¯¸í•œë‹¤.
> 

<br/>

<br/>

### ì„¸ë§ˆí¬ í•´ê²°ì•ˆ

> í•œê°€ì§€ ê°„ë‹¨í•œ í•´ê²°ì•ˆ : ê° ì “ê°€ë½ì„ í•˜ë‚˜ì˜ ì„¸ë§ˆí¬ë¡œ í‘œí˜„!
> 
> - ì² í•™ìëŠ” ê·¸ ì„¸ë§ˆí¬ì— wait() ì—°ì‚°ì„ ì‹¤í–‰í•´ ì “ê°€ë½ì„ ì§‘ìœ¼ë ¤ ì‹œë„í•œë‹¤.
> - ë˜í•œ í•´ë‹¹ ì„¸ë§ˆí¬ì— signal() ì—°ì‚°ì„ ì‹¤í–‰í•´ ìì‹ ì˜ ì “ê°€ë½ì„ ë†“ëŠ”ë‹¤.

<br/>

<br/>

- ìœ„ ê°€ì •ì„ ìœ„í•œ ê³µìœ  ìë£ŒëŠ” ì•„ë˜ì™€ ê°™ë‹¤.
    
    ```c
    semaphore chopstick[5];
    ```
    

<br/>

<br/>

- ì² í•™ì `i`ì˜ êµ¬ì¡°
    
    ```c
    while (true) {
    		wait(chopstick[i]);
    		wait(chopstick[(i + 1) % 5]);
    		...
    		/* eat for a while */
    		...
    		signal(chopstick[i]);
    		signal(chopstick[(i + 1) % 5]);
    		...
    		/* think for awhile */
    		...
    }
    ```
    

<br/>

<br/>

> ì´ í•´ê²°ì•ˆì€ ì¸ì ‘í•œ ë‘ ì² í•™ìê°€ ë™ì‹œì— ì‹ì‚¬í•˜ì§€ ì•ŠëŠ”ë‹¤ëŠ” ê²ƒì„ ë³´ì¥í•˜ì§€ë§Œ, êµì°© ìƒíƒœë¥¼ ì•¼ê¸°í•  ìˆ˜ ìˆë‹¤.
> 
> - ex) ëª¨ë“  ì² í•™ìê°€ ë™ì‹œì— ë°°ê°€ ê³ íŒŒ ê°ê° ìì‹ ì˜ ì™¼ìª½ ì “ê°€ë½ì„ ì¡ëŠ”ë‹¤ê³  ê°€ì •!
> - ì´ë•Œ, ê° ì² í•™ìê°€ ì˜¤ë¥¸ìª½ ì “ê°€ë½ì„ ì§‘ìœ¼ë ¤ê³  í•˜ë©´ ì˜ì›íˆ ê¸°ë‹¤ë ¤ì•¼ í•œë‹¤.

<br/>

<br/>

> êµì°© ìƒíƒœ ë¬¸ì œì— ëŒ€í•œ ì—¬ëŸ¬ ê°€ì§€ í•´ê²°ì±…
> 
> - ìµœëŒ€ 4ëª…ì˜ ì² í•™ìë§Œì´ í…Œì´ë¸”ì— ë™ì‹œì— ì•‰ì„ ìˆ˜ ìˆë„ë¡ í•œë‹¤.
> - í•œ ì² í•™ìê°€ ì “ê°€ë½ ë‘ ê°œë¥¼ ëª¨ë‘ ì§‘ì„ ìˆ˜ ìˆì„ ë•Œë§Œ ì “ê°€ë½ì„ ì§‘ë„ë¡ í—ˆìš©í•œë‹¤.
> - ë¹„ëŒ€ì¹­ í•´ê²°ì•ˆì„ ì‚¬ìš©í•œë‹¤.

<br/>

<br/>

### ëª¨ë‹ˆí„° í•´ê²°ì•ˆ

> ì´ í•´ê²°ì•ˆì€ ì² í•™ìê°€ ì–‘ìª½ ì “ê°€ë½ì„ ëª¨ë‘ ì–»ì„ ìˆ˜ ìˆì„ ë•Œë§Œ ì “ê°€ë½ì„ ì§‘ì„ ìˆ˜ ìˆë‹¤ëŠ” ì œí•œì„ ê°•ì œí•œë‹¤.
> 
> - ë”°ë¼ì„œ êµì°© ìƒíƒœê°€ ì—†ëŠ” í•´ê²°ì•ˆì´ë‹¤.

<br/>

<br/>

- ì´ í•´ê²°ì•ˆì„ êµ¬í˜„í•˜ê¸° ìœ„í•´ ì² í•™ìì˜ ìƒíƒœë¥¼ êµ¬ë¶„í•œë‹¤.
    
    ```c
    enum {THINKING, HUNGRY, EATING} state[5]; 
    ```
    
    - ì–‘ìª½ ë‘ ì´ì›ƒì´ ì‹ì‚¬í•˜ì§€ ì•Šì„ë•Œë§Œ `state[i] = EATING` ìœ¼ë¡œ ì„¤ì •í•  ìˆ˜ ìˆë‹¤.

<br/>

<br/>

- ë˜í•œ ë‹¤ìŒì„ ì„ ì–¸í•´ì•¼ í•œë‹¤.
    
    ```c
    condition self[5];
    ```
    
    - `self`ëŠ” ì² í•™ì iê°€ ë°°ê³ í”„ì§€ë§Œ ìì‹ ì´ ì›í•˜ëŠ” ì§‘ê°€ë½ì„ ì§‘ì„ ìˆ˜ ì—†ë‹¤ë©´ ì§‘ê¸°ë¥¼ ë¯¸ë£¨ë„ë¡ í•œë‹¤.

<br/>

<br/>

- ëª¨ë‹ˆí„° í•´ê²°ì•ˆ ì½”ë“œ
    
    <img src="https://github.com/2dongyeop/TIL/blob/main/OS/image/monitor-solution.png" width = 600/>


<br/>

<br/>

## ğŸ’¡Â ì»¤ë„ ì•ˆì—ì„œì˜ ë™ê¸°í™” 

### Windowsì˜ ë™ê¸°í™”

> WindowsëŠ” ì»¤ë„ ì™¸ë¶€ì—ì„œ ìŠ¤ë ˆë“œë¥¼ ë™ê¸°í™”í•˜ê¸° ìœ„í•´ **dispatcher** ê°ì²´ë¥¼ ì œê³µí•œë‹¤.
> 
> - ìŠ¤ë ˆë“œëŠ” ì´ ê°ì²´ë¥¼ ì‚¬ìš©í•´ mutexë½, ì„¸ë§ˆí¬, event ë“±ì„ í¬í•¨í•œ ë‹¤ì–‘í•œ ê¸°ë²•ì— ë§ì¶”ì–´ ë™ê¸°í™”í•œë‹¤.
> - EventëŠ” ì¡°ê±´ ë³€ìˆ˜ì™€ ìœ ì‚¬í•˜ë‹¤! â†’ ê¸°ë‹¤ë¦¬ëŠ” ì¡°ê±´ì´ ë§Œì¡±í•˜ë©´ ìŠ¤ë ˆë“œì— í†µì§€í•˜ëŠ” ì—­í• 

<br/>

<br/>

- Dispatcher ê°ì²´ëŠ” `signaled` ìƒíƒœ í˜¹ì€ `nonsignaled` ìƒíƒœì´ë‹¤.
    - `signaled` : ê°ì²´ê°€ ì‚¬ìš© ê°€ëŠ¥í•˜ê³  ê·¸ ê°ì²´ë¥¼ ì–»ì„ ë•Œ ê·¸ ìŠ¤ë ˆë“œê°€ ë´‰ì‡„ë˜ì§€ ì•ŠìŒ.
    - `nonsignaled` : ê°ì²´ê°€ ì‚¬ìš©í•  ìˆ˜ ì—†ê³ , ê·¸ ê°ì²´ë¥¼ ì–»ìœ¼ë ¤ê³  ì‹œë„í•˜ë©´ ìŠ¤ë ˆë“œê°€ ë´‰ì‡„ë¨.

<br/>

<br/>

<img src="https://github.com/2dongyeop/TIL/blob/main/OS/image/mutex-dispatcher.png" width = 600/>

<br/>

<br/>

> Dispatcher ê°ì²´ì˜ ìƒíƒœì™€ ìŠ¤ë ˆë“œ ìƒíƒœ ê°„ì—ëŠ” ê´€ë ¨ì„±ì´ ìˆë‹¤.
> 
> - ìŠ¤ë ˆë“œê°€ `nonsignaled` ìƒíƒœì— ìˆëŠ” dispatcher ê°ì²´ ë•Œë¬¸ì— ë´‰ì‡„ë˜ë©´ ê·¸ ìŠ¤ë ˆë“œì˜ ìƒíƒœëŠ” ì¤€ë¹„ë¡œë¶€í„° ëŒ€ê¸° ìƒíƒœë¡œ ë°”ë€Œê³  ê·¸ ìŠ¤ë ˆë“œëŠ” ê·¸ ê°ì²´ì˜ ëŒ€ê¸° íì— ë„£ì–´ì§€ê²Œ ëœë‹¤.
> - ì¶”í›„ dispatcher ê°ì²´ì˜ ìƒíƒœê°€ `signaled` ìƒíƒœë¡œ ë°”ë€Œë©´ ì»¤ë„ì€ ê·¸ ê°ì²´ë¥¼ ê¸°ë‹¤ë¦¬ëŠ” ìŠ¤ë ˆë“œê°€ ìˆëŠ”ì§€ ì—¬ë¶€ë¥¼ ì•Œì•„ë‚¸ë‹¤.

<br/>

<br/>

- **Critical-section** ê°ì²´ë€?
    - ì»¤ë„ì˜ ê°œì… ì—†ì´ íšë“í•˜ê±°ë‚˜ ë°©ì¶œí•  ìˆ˜ ìˆëŠ” ì‚¬ìš©ì ëª¨ë“œ mutexì´ë‹¤.
    - `critical-section` ê°ì²´ëŠ” ì»¤ë„ mutexê°€ ê°ì²´ì— ëŒ€í•œ ê²½ìŸì´ ë°œìƒí•  ë•Œë§Œ í• ë‹¹ë˜ê¸° ë•Œë¬¸ì— íš¨ìœ¨ì ì´ë‹¤! â†’ ì‹¤ì œë¡œ CPU ì ˆì•½ì´ ìƒë‹¹íˆ ì¢‹ì•„ì§„ë‹¤!

<br/>

<br/>

### Linuxì˜ ë™ê¸°í™”

> LinuxëŠ” ì»¤ë„ ì•ˆì—ì„œ ë™ê¸°í™”í•  ìˆ˜ ìˆëŠ” ë§ì€ ë‹¤ë¥¸ ê¸°ë²•ì„ ì œê³µí•œë‹¤.
> 
> - ê°€ì¥ ê°„ë‹¨í•œ ê¸°ë²•ì€ ì›ìì  ì •ìˆ˜ë¥¼ ì´ìš©í•˜ëŠ” ê²ƒì´ë‹¤.

<br/>

<br/>

- ì•„ë˜ ì½”ë“œëŠ” ë‹¤ì–‘í•œ ì›ìì  ì—°ì‚°ì„ ìˆ˜í–‰í•œ íš¨ê³¼ì´ë‹¤.
    
    <img src="https://github.com/2dongyeop/TIL/blob/main/OS/image/atomic-operation.png" width = 600/>
    

<br/>

<br/>

- ì›ìì  ì •ìˆ˜ëŠ” counter(ì •ìˆ˜í˜• ë³€ìˆ˜)ê°€ ê°±ì‹ ë˜ì–´ì•¼ í•˜ëŠ” ìƒí™©ì—ì„œ íŠ¹íˆ íš¨ìœ¨ì ì´ë‹¤!
    - ì™œëƒë©´ ì›ìì  ì—°ì‚°ì„ ë½ ê¸°ë²•ì„ ì‚¬ìš©í•  ë•ŒëŠ” ì˜¤ë²„í—¤ë“œê°€ í•„ìš”í•˜ì§€ ì•Šê¸° ë•Œë¬¸!

<br/>

<br/>

- Linux ì»¤ë„ì€ ì»¤ë„ ì•ˆì—ì„œì˜ ë½í‚¹ì„ ìœ„í•´ ìŠ¤í•€ë½ê³¼ ì„¸ë§ˆí¬ ë° ë‘ ë½ì˜ reader-writer ë²„ì „ë„ ì œê³µí•œë‹¤.
    - SMP ê¸°ê³„ì—ì„œëŠ” ê¸°ë³¸ì ì¸ ë½í‚¹ ê¸°ë²•ì€ ìŠ¤í•€ë½ì´ë‹¤.
    - ê°„ë‹¨í•˜ê²Œ ìš”ì•½í•˜ë©´ ì•„ë˜ì™€ ê°™ë‹¤.
        
        <br/>

        <img src="https://github.com/2dongyeop/TIL/blob/main/OS/image/Linux-smp.png" width = 600/>
        
        - Linux ì»¤ë„ì—ì„œ ìŠ¤í•€ë½ê³¼ mutex ë½ì€ ***ì¬ê·€ì ì´ì§€ ì•Šë‹¤!***
            - ì¦‰, ìŠ¤ë ˆë“œê°€ ì´ëŸ¬í•œ ë½ ì¤‘ í•˜ë‚˜ë¥¼ íšë“í–ˆë‹¤ë©´?
            - â†’ ë½ì„ í•´ì œí•˜ì§€ ì•Šê³ ëŠ” ê°™ì€ ë½ì„ ë‹¤ì‹œ íšë“í•  ìˆ˜ ì—†ë‹¤.


<br/>

<br/>

## ğŸ’¡ POSIX ë™ê¸°í™” 

### POSIX mutex ë½

> Pthreadsì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ê¸°ë³¸ì ì¸ ë™ê¸°í™” ê¸°ë²•ì„ ëŒ€í‘œí•œë‹¤.
> 
> - ì´ëŠ” ì½”ë“œì˜ ì„ê³„êµ¬ì—­ì„ ë³´í˜¸í•˜ê¸° ìœ„í•´ ì‚¬ìš©ëœë‹¤.
> - ì¦‰, ìŠ¤ë ˆë“œëŠ” ì„ê³„êµ¬ì—­ì— ì§„ì…í•˜ê¸° ì „ì— ë½ì„ íšë“í•˜ê³  ì„ê³„êµ¬ì—­ì—ì„œ ë‚˜ê°ˆ ë•Œ ë½ì„ ë°©ì¶œí•œë‹¤.

<br/>

<br/>

- Mutex ì½”ë“œ ì˜ˆì‹œ ì¼ë¶€
    
    ```c
    #include <pthread.h>
    pthread mutex t mutex;
    
    /* create and initialize the mutex lock */
    pthread mutex init(&mutex,NULL);
    
    /* acquire the mutex lock */ 
    pthread mutex lock(&mutex);
    
    /* critical section */
    
    /* release the mutex lock */
    pthread mutex unlock(&mutex);
    ```
    

<br/>

<br/>

### POSIX ì„¸ë§ˆí¬

> POSIXëŠ” ê¸°ëª…(`named`)ê³¼ ë¬´ëª…(`un-named`)ì˜ ë‘ ìœ í˜•ì˜ ì„¸ë§ˆí¬ë¥¼ ëª…ê¸°í•˜ê³  ìˆë‹¤.
> 
> - ê¸°ë³¸ì ìœ¼ë¡œ ì´ ë‘ê°€ì§€ëŠ” ë§¤ìš° ìœ ì‚¬í•˜ì§€ë§Œ í”„ë¡œì„¸ìŠ¤ ê°„ì— ìƒì„± ë° ê³µìœ ë˜ëŠ” ë°©ì‹ì´ ë‹¤ë¥´ë‹¤.

<br/>

<br/>

- ê¸°ëª… ì„¸ë§ˆí¬ ì½”ë“œ
    - `sem_open()` : POSIX ê¸°ëª… ì„¸ë§ˆí¬ë¥¼ ìƒì„±í•˜ê³  ì—¬ëŠ”ë° ì‚¬ìš©
    
    ```c
    #include <semaphore.h>
    sem t *sem;
    
    /* Create the semaphore and initialize it to 1 */
    sem = sem open("SEM", O CREAT, 0666, 1);
    
    /* acquire the semaphore */ 
    sem wait(sem);
    
    /* critical section */
    
    /* release the semaphore */
    sem post(sem);
    ```
    
    - ***ì¥ì  : ì—¬ëŸ¬ ê´€ë ¨ ì—†ëŠ” í”„ë¡œì„¸ìŠ¤ê°€ ì„¸ë§ˆí¬ ì´ë¦„ë§Œ ì°¸ì¡°í•˜ì—¬ ë™ê¸°í™” ê¸°ë²•ìœ¼ë¡œ ì‰½ê²Œ ì‚¬ìš© ê°€ëŠ¥í•˜ë‹¤!***

<br/>

<br/>

- ë¬´ëª… ì„¸ë§ˆí¬ ì½”ë“œ
    
    ```c
    #include <semaphore.h> 
    sem t sem;
    
    /* Create the semaphore and initialize it to 1 */ 
    sem init(&sem, 0, 1);
    
    /* acquire the semaphore */ 
    sem wait(&sem);
    
    /* critical section */
    
    /* release the semaphore */ 
    sem post(&sem);
    ```
    

<br/>

<br/>

### POSIX ì¡°ê±´ ë³€ìˆ˜

> Pthreadì˜ ì¡°ê±´ ë³€ìˆ˜ëŠ” pthread_cond_t ë°ì´í„° ìœ í˜•ì„ ì‚¬ìš©í•˜ê³ , pthread_cond_init()ì„ ì‚¬ìš©í•´ ì´ˆê¸°í™”í•œë‹¤.
> 

- ì½”ë“œ
    
    ```c
    pthread mutex t mutex; 
    pthread cond t cond var;
    
    pthread mutex init(&mutex,NULL); 
    pthread cond init(&cond var,NULL);
    
    pthread mutex lock(&mutex); 
    while (a != b)
    		pthread cond wait(&cond var, &mutex); 
    
    pthread mutex unlock(&mutex);
    ```


<br/>

<br/>

## ğŸ’¡Â Javaì—ì„œì˜ ë™ê¸°í™” 

### Java ëª¨ë‹ˆí„°

> JavaëŠ” ìŠ¤ë ˆë“œ ë™ê¸°í™”ë¥¼ ìœ„í•œ ëª¨ë‹ˆí„°ì™€ ê°™ì€ ë³‘ìƒì„± ê¸°ë²•ì„ ì œê³µí•œë‹¤.
> 
> - `BoundedBuffer` í´ë˜ìŠ¤ëŠ” ìƒì‚°ìì™€ ì†Œë¹„ì ë¬¸ì œì˜ í•´ê²°ì•ˆì„ êµ¬í˜„í•œë‹¤.

<br/>

<br/>

- `BoundedBuffer` í´ë˜ìŠ¤
    
    <img src="https://github.com/2dongyeop/TIL/blob/main/OS/image/BoundedBuffer.png" width = 600/>
    

<br/>

<br/>

- `synchronized` ë©”ì†Œë“œë¥¼ í˜¸ì¶œí•˜ë ¤ë©´?
    - â†’ BoundedBufferì˜ ê°ì²´ ì¸ìŠ¤í„´ìŠ¤ì™€ ì—°ê²°ëœ ë½ì„ ì†Œìœ í•´ì•¼ í•œë‹¤.

<br/>

<br/>

- ë‹¤ë¥¸ ìŠ¤ë ˆë“œê°€ ì´ë¯¸ ë½ì„ ì†Œìœ í–ˆë‹¤ë©´?
    - â†’ ê°ì²´ì˜ ë½ì— ì„¤ì •ëœ **ì§„ì… ì§‘í•©**(entry set)ì— ì¶”ê°€ëœë‹¤.
    - ì´ ì§„ì… ì§‘í•©ì€ ë½ì´ ê°€ìš©í•´ì§€ê¸°ë¥¼ ê¸°ë‹¤ë¦¬ëŠ” ìŠ¤ë ˆë“œ ì§‘í•©ì´ë‹¤.
        
        <img src="https://github.com/2dongyeop/TIL/blob/main/OS/image/entry-set.png" width = 600/>
        

<br/>

<br/>

> ë½ì„ ê°–ëŠ” ê²ƒ ì™¸ì—ë„ ëª¨ë“  ê°ì²´ëŠ” ìŠ¤ë ˆë“œ ì§‘í•©ìœ¼ë¡œ êµ¬ì„±ëœ **ëŒ€ê¸° ì§‘í•©**ê³¼ ì—°ê²°ë¨ì„ ì•Œê³  ìˆì!
> 

<br/>

<br/>

- ì „ì²´ ì½”ë“œ
    
    ```java
    /* Producers call this method */
    public synchronized void insert(E item) {
    		while (count == BUFFER SIZE) { 
    				try {
    						wait(); //ë²„í¼ê°€ ê°€ë“ ì°¨ë©´ í˜¸ì¶œ
    				}catch (InterruptedException ie) {}
    		}
    
    		buffer[in] = item;
    		in = (in + 1) % BUFFER SIZE; 
    		count+;
    		notify();
    }
    
    <br/>

    /* Consumers call this method */ 
    public synchronized E remove() {
    		E item;
    		while (count == 0) { 
    				try {
    						wait();
    				}
    		}catch (InterruptedException
    
    		item = buffer[out];
    		out = (out + 1) % BUFFER SIZE; 
    		count--;
    
    		notify();
    		return item;
    }
    ```
    

<br/>

<br/>

### ì¬ì§„ì… ë½

> APIì—ì„œ ì‚¬ìš© ê°€ëŠ¥í•œ ê°€ì¥ ê°„ë‹¨í•œ ë½ ê¸°ë²•ì€ **ReentrantLock**ì´ë‹¤.
> 
> - ì´ëŠ” ì—¬ëŸ¬ê°€ì§€ ë©´ì—ì„œ synchronized ëª…ë ¹ë¬¸ì²˜ëŸ¼ ì‘ë™í•œë‹¤.
> - ë‹¨ì¼ ìŠ¤ë ˆë“œê°€ ì†Œìœ í•˜ë©°, ê³µìœ  ìì›ì— ëŒ€í•œ ìƒí˜¸ ë°°íƒ€ì  ì•¡ì„¸ìŠ¤ë¥¼ ì œê³µí•˜ëŠ” ë° ì‚¬ìš©ëœë‹¤.

<br/>

<br/>

- `ReentrantLock`ì€ ***ê³µì •ì„±*** ë§¤ê°œë³€ìˆ˜ ì„¤ì •ê³¼ ê°™ì€ ëª‡ ê°€ì§€ ì¶”ê°€ ê¸°ëŠ¥ì„ ì œê³µí•œë‹¤.
    - ì´ ê³µì •ì„±ì€ ì˜¤ë˜ ê¸°ë‹¤ë¦° ìŠ¤ë ˆë“œì— ë½ì„ ì¤„ ìˆ˜ ìˆëŠ” ì„¤ì •ì´ë‹¤.

<br/>

<br/>

- ì½”ë“œ
    - ë½ì„ ì‚¬ìš©í•  ìˆ˜ ìˆê±°ë‚˜ `lock()` ì„ í˜¸ì¶œí•œ ìŠ¤ë ˆë“œê°€ ì´ë¯¸ ë½ì„ ì†Œìœ í•œ ê²½ìš° â†’ **ì¬ì§„ì…**
    
    ```java
    Lock key = new ReentrantLock();
    
    key.lock(); 
    try {
    		/* critical section */
    		//ì˜ˆì™¸ê°€ ë°œìƒí•˜ë©´ ë½ì´ í•´ì œë˜ëŠ” ê²ƒì„ ë³´ì¥
    }
    finally {
    		key.unlock(); 
    }
    ```
    

<br/>

<br/>

> `ReentrantLock` ì€ ìƒí˜¸ ë°°ì œë¥¼ ì œê³µí•˜ì§€ë§Œ ì—¬ëŸ¬ ìŠ¤ë ˆë“œê°€ ê³µìœ  ë°ì´í„°ë¥¼ ì½ê¸°ë§Œ í•  ë•Œì—ëŠ” ë„ˆë¬´ ë³´ìˆ˜ì ì¸ ì „ëµì¼ ìˆ˜ ìˆë‹¤.
ì´ë¥¼ ìœ„í•´ Java APIëŠ” `ReentrantReadWriteLock` ì„ ì œê³µí•œë‹¤.
> 

<br/>

<br/>

### ì„¸ë§ˆí¬

- ìƒí˜¸ ë°°ì œë¥¼ ìœ„í•´ ì„¸ë§ˆí¬ë¥¼ ì‚¬ìš©í•˜ëŠ” ë°©ë²•
    
    ```java
    Semaphore sem = new Semaphore(1);
    
    try {
    		sem.acquire();
    		/* critical section */
    }
    catch (InterruptedException ie) { } 
    finally {
    		sem.release(); //ì„¸ë§ˆí¬ê°€ ë°˜ë“œì‹œ í•´ì œë˜ë„ë¡ finally ì ˆ ì•ˆì— ì‘ì„±
    }
    ```
    

<br/>

<br/>

### ì¡°ê±´ ë³€ìˆ˜

> ì¡°ê±´ ë³€ìˆ˜ëŠ” wait() ë° notify() ë©”ì†Œë“œì™€ ìœ ì‚¬í•œ ê¸°ëŠ¥ì„ ì œê³µí•œë‹¤.
ë”°ë¼ì„œ ìƒí˜¸ ë°°ì œë¥¼ ì œê³µí•˜ë ¤ë©´ ì¡°ê±´ ë³€ìˆ˜ë¥¼ ì¬ì§„ì… ë½ê³¼ ì—°ê´€ì‹œì¼œì•¼ í•œë‹¤.
> 

<br/>

<br/>

- ì´ˆê¸° ê³¼ì •
    - ë¨¼ì € ReentrantLockì„ ìƒì„± í›„ ì¡°ê±´ ë³€ìˆ˜ë¥¼ ìƒì„±
    
    ```java
    Lock key = new ReentrantLock();
    Condition condVar = key.newCondition();
    ```
    

<br/>

<br/>

- Java ì¡°ê±´ ë³€ìˆ˜ë¥¼ ì´ìš©í•œ ì˜ˆì œ
    
    ```java
    /* threadNumber is the thread that wishes to do some work */ 
    public void doWork(int threadNumber) {
    		lock.lock();
    
    		try {
    				/**
    	      * If itâ€™s not my turn, then wait
    	      * until Iâ€™m signaled.
    	      */
    				if (threadNumber != turn) 
    						condVars[threadNumber].await();
    
    				/**
    	      * Do some work for awhile ...
    	      */
    	     /**
    
    	      * Now signal to the next thread.
    	      */
    		    turn = (turn + 1) % 5;
    				condVars[turn].signal();
    		}
    		catch (InterruptedException ie) { } 
    		finally {
    	     lock.unlock();
    		}
    }
    ```


<br/>

<br/>
