# 스레드와 병행성

>💡 ***이 장의 목표***
>
>- *스레드이 기본 구성요소를 식별하고 스레드와 프로세스를 대조한다.*
>- *다중 스레드 프로세스를 설계할 때의 주요 이점과 중대한 과제를 설명한다.*
>- *스레드 풀, 포크 조인 및 그랜드 센트럴 디스패치를 포함하여 암시적 스레딩에 대한 다양한 접근 방식을 설명한다.*

<br/>

<br/>

## 💡 개요


>💡 스레드는 CPU의 이용 기본 단위로, 스레드 ID, 프로그램 카운터, 레지스터 집합, 스택으로 구성된다.
>
>스레드는 같은 프로세스에 속한 다른 스레드와 운영체제 자원들을 공유한다.
>
>단일 스레드 프로세스와 다중 스레드 프로세스의 차이점을 알아보자!

<br/>

<br/>

### 동기

<img src="https://github.com/2dongyeop/TIL/blob/main/OS/image/single-multi-thread.png" width = 600/>

- 현대의 컴퓨터와 모바일 기기에서 작동하는 거의 모든 소프트웨어 응용들은 다중 스레드를 이용한다.
    - 하나의 응용은 몇 개의 실행 흐름을 가진 독립적인 프로세스로 구현된다.
    - ex) 웹 브라우저 : 이미지를 띄우고, 텍스트를 표시하고, 데이터 검색을 동시에..

<br/>

<br/>

- 응용은 다중 코어 시스템에서 처리 능력을 향상시키도록 설계될 수 있다.
    - 이러한 응용은 다중 계산 코어를 사용하여 다수의 CPU-집중 작업을 병렬로 처리할 수 있다.

<br/>

<br/>

- 하나의 응용 프로그램이 여러 개의 비슷한 작업을 수행할 필요가 있는 상황들이 있을 수 있다!
    - ex) 수천개의 클라이언트가 하나의 웹서버에 병행 접근하는 상황
    - 이때, 웹 서버가 전통적인 단일 스레드 프로세스라면? → 매우 긴 대기 시간이 발생

<br/>

<br/>

<img src="https://github.com/2dongyeop/TIL/blob/main/OS/image/multithread-server.png" width = 600/>

<br/>

<br/>

- 해결법
    - ***서버가 요청을 받아들이는 하나의 프로세스로 동작하게 하자!***
    - ⇒ 서버에게 서비스 요청이 들어오면, 프로세스는 그 요청을 수행할 별도 프로세스로 생성!
    - ***단, 이 방식은 기존 프로세스와 하는 일이 동일하다면? → 여러 스레드를 만들어나가자.***

<br/>

<br/>

- 많은 응용 프로그램도 기본 정렬, 트리 및 그래프 알고리즘을 포함하여 다중 스레드를 활용할 수 있다.

<br/>

<br/>

### 장점

> 다중 스레드 프로그래밍의 이점은 다음의 4가지 큰 부류로 나눌 수 있다.
 

1. ***응답성(responsiveness)***
    1. 대화형 응용을 다중 스레드화 → 응용의 일부가 봉쇄되거나, 긴 작업을 수행하도록 허용 → 응답성 증가
    2. 이 특징은 사용자 인터페이스를 설계하는 데 있어 특히 유용하다.
2. ***자원 공유(resource sharing)***
    1. 스레드는 자동으로 그들이 속한 프로세스의 자원들과 메모리를 공유한다.
3. ***경제성(economy)***
    1. 프로세스 생성에 비해 스레드를 생성하고 문맥 교환하는 것은 훨씬 경제적이다.
4. ***규모 적응성(scalability)***
    1. 다중 처리기 구조에서는 각각의 스레드가 다른 처리기에서 병렬로 수행할 수 있어 이점이 더 크다.


<br/>

<br/>

## 💡 다중 코어 프로그래밍

<img src="https://github.com/2dongyeop/TIL/blob/main/OS/image/single-core.png" width = 600/>

- 컴퓨터는 점차 발전하여 단일 컴퓨팅 칩에 여러 컴퓨팅 코어를 배치하기 시작했다.
    - 각 코어는 운영체제에 별도로 CPU로 보이는데, 이를 **다중 코어** 시스템이라고 한다.
    - ***다중 스레드 프로그래밍은 이런 여러 컴퓨팅 코어를 보다 효율적으로 사용하고 병행성을 향상시킨다!***

<br/>

<br/>

- 현재 논의에서 ***병행성***과 ***병렬성***의 차이점에 주목하자.
    - **병행** : 모든 작업이 진행되게 하여 둘 이상의 작업을 지원한다.
    - **병렬** : 둘 이상의 작업을 동시에 수행할 수 있다.

<br/>

<br/>

### 프로그래밍 도전과제

<img src="https://github.com/2dongyeop/TIL/blob/main/OS/image/multi-core.png" width = 600/>


- 프로그래밍 도전 과제
    - 운영체제 설계자 : 병렬 수행이 될도록 여러 코어를 활용하는 스케줄링 알고리즘을 개발해야 한다.
    - 응용 프로그래머 : 기존 프로그램을 다중 스레드를 사용할 수 있도록 수정해야 한다.

<br/>

<br/>

- 다중 코어 시스템을 위해 프로그래밍하기 위한 5개의 ***극복해야 할 도전 과제!***
    1. **태스크 인식(identifying tasks)**
        1. 응용을 분석하여 독립된 병행 가능 태스크로 나눌 수 있는 영역을 찾을 수 있어야 한다.
    2. **균형(balance)**
        1. 찾아진 부분들이 전체 작업에 균등한 기여도를 가지도록 태스크로 나누는 것도 매우 중요하다.
    3. **데이터 분리(data spliting)**
        1. 응용이 독립된 태스크로 나누어지듯, 태스크가 접근하고 조작하는 데이터도 나누어져야 한다.
    4. **데이터 종속성(data dependency)**
        1. 태스크가 접근하는 데이터는 둘 이상의 태스크 사이에 종속성이 없는지 검토되어야 한다.
    5. **시험 및 디버깅(testing and debugging)**
        1. 프로그램이 다중 코어에서 병렬로 실행될 때, 다양한 실행 경로가 존재할 수 있다.
        2. 단일 스레드 응용의 시험 및 디버깅보다 훨씬 어렵지만, 필수적이다.

<br/>

<br/>

### 병렬 실행의 유형

<img src="https://github.com/2dongyeop/TIL/blob/main/OS/image/data-and-task-parallelism.png" width = 600/>


<br/>

<br/>

- ***데이터 병렬 실행***
    - 동일한 데이터를 다수의 계산 코어에 분배한 뒤 각 코어에서 동일한 연산을 실행한다.

<br/>

<br/>

- ***태스크 병렬 실행***
    - 데이터가 아니라 태스크(스레드)를 다수의 코어에 분배한다.
    - 각 스레드는 고유의 연산을 실행한다.

<br/>

<br/>

- *데이터와 태스크 병렬 처리는 상호 배타적이지 않고, 실제론 두 가지 전략을 혼합하여 사용할 수도 있다!*

<br/>

<br/>

