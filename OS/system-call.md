# 시스템 콜(호출)
운영 체제가 응용 프로그램에게 제공하는 인터페이스로, 인터럽트 중 하나이다.

<br/>

> 시스템 콜을 설명하기 이전에, 아래 두 가지 개념에 대한 지식이 필요하다.
> 
> - 커널 모드
>
> - 사용자 모드

<br/>

## 커널(kernel)이란?
<img src="https://github.com/2dongyeop/TIL/blob/main/OS/image/kernel.png" width = 500/>

- 커널(Kernel)의 사전적 의미는 핵심이란 뜻으로, 시스템의 모든 것을 완전히 통제하는 핵심 프로그램이다.
- 하드웨어와 프로세스를 연결하는 핵심 인터페이스로, 소프트웨어와 하드웨어를 연결해준다.

<br/>

### 커널의 기능
1. 프로세스 관리 : 프로세스 생성 및 제거를 담당하고, 스케줄러를 이용하여 여러 프로세스 동작을 제어한다.
2. 메모리 관리 : 각 프로세스가 독립적으로 사용할 수 있는 가상 주소 공간을 제공한다.
    -  가상 주소 공간 : 프로세스가 실행되는 물리 메모리의 실제 주소를 가리키는 주소들의 집합으로, 가상 주소를 물리 주소로 매핑하며 실행이 된다.
3. 파일 시스템 관리 : 시스템에 동작하는 모든 자원을 파일처럼 다룰 수 있도록 인터페이스를 제공한다.

<br/>

<br/>

## 커널 모드
- 모든 하드웨어와 모든 주소 공간에 접근이 가능하다.
- 유저모드보다 더 높은 (관리자)권한이 필요하다.

<br/>

## 사용자 모드
- 사용자가 접근할 수 있는 영역(권한)으로, `코드 영역, 데이터 영역, 스택 및 힙 영역`을 가리킨다.
- 유저 어플리케이션의 코드가 유저 모드에서 실행된다.

<br/>

### 사용자 모드에서 커널 모드로 전환되는 경우
- 프로세스가 유저 모드에서 실행되다가 특별한 작업이 필요할 때 `system call`을 이용하여 커널에 요청한다.
  - 이 요청을 특권 명령이라고 하며, 주로 입출력 장치, 타이머 등 각종 장치를 접근하는 명령이다.

<br/>

### 커널 모드에서 사용자 모드로 전환되는 경우
- `system call` 요청을 수행하고, 결과값을 `system call`의 리턴 값으로 전환하며 유저모드로 돌아간다.

<br/>


<br/>

## 시스템 콜의 필요성
- OS는 하드웨어의 보안을 유지하기 위해서 운영체제는 커널 모드와 사용자 모드로 나뉘어 구동된다.
- 시스템 콜은 이러한 커널 영역의 기능을 사용자 모드가 사용 가능하게 해준다.
    - ex) 파일을 읽고, 쓰고, 혹은 화면에 메시지를 출력하는 등


<br/>

### 시스템 콜 호출 과정

<img src="https://github.com/2dongyeop/TIL/blob/main/OS/image/system-call.png" width = 500/>

1. 사용자 프로그램이 시스템 콜을 하게 되면 운영체제는 자신의 커널 영역에 정의된 시스템 콜 처리 코드를 수행한다.
2. CPU가 컨트롤 레지스터를 세팅하고, 디스크 컨트롤러에게 데이터를 읽어오라고 명령한다.
3. 디스크 컨트롤러는 디스크로부터 데이터를 읽어온 뒤, 자신의 로컬 버퍼에 저장한다.
4. 작업이 완료되면 디스크 컨트롤러가 CPU에게 인터럽트를 발생시켜 입출력 작업이 완료되었음을 통지한다.

<br/>

<br/>

> 필요한 기능이나 시스템 환경에 따라 시스템 콜이 발생할 때, 좀 더 많은 정보가 필요할 수도 있다. 
> 
> 그러한 정보가 담긴 매개변수를 운영체제에 전달하기 위해서는 대략 3가지 정도의 방법이 있다.

<br/>

### 운영체제에 매개변수를 전달하는 3가지 방법

<img src="https://github.com/2dongyeop/TIL/blob/main/OS/image/parameter-delivery.png" width = 500/>

1. 매개변수를 `CPU 레지스터` 내에 전달한다. 
    - 이 경우, 레지스터의 크기가 작아 용량에 제한이 있다.
2. 매개변수를 메모리에 저장하고 `메모리의 주소`가 레지스터에 전달된다. (위 그림에 해당)
3. 매개변수는 프로그램에 의해 `스택`으로 전달될 수도 있다.

<br/>

<br/>

## 시스템 콜의 유형
- 크게 5가지로 나눌 수 있다.
1. 프로세스 제어 : 프로세스 특권 모드를 사용해 직접적으로 프로세스 제어가 가능
2. 파일 조작 : 파일을 생성하거나 삭제, 관리 등
3. 장치 관리 : 장치 요구 및 장치 해제, 읽기, 쓰기, 재배치 등
4. 정보 유지 : 시간과 날짜의 설정과 획득, 시스템 자료의 설정과 획득
5. 통신 : 통신 연결의 생성 및 제거, 메시지의 송수신, 상태 정보 전달 등