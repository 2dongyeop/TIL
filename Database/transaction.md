## 트랜잭션

> 트랜잭션이란?
> 

→ 데이터베이스의 상태를 변화시키는 하나의 논리적인 작업 단위로, 여러 개의 연산이 수행될 수 있다.

<br/>

<br/>

> 트랜잭션을 사용하는 이유
> 

→ 하나의 논리적인 작업 단위이기 때문에, 여러 개의 작업을 하나의 논리적인 단위로 묶어서 반영과 복구를 조정할 수 있도록 하기 위함이다.

→ 데이터의 부정합이 일어났을 경우, 롤백을 통해 부정합을 방지한다!


<br/>

<br/>

> 트랜잭션의 성질 : ACID
> 
- Atomicity(원자성)
    - 트랜잭션의 연산은 데이터베이스에 모두 반영되거나 전혀 반영되지 않은 상태여야 한다.
        - ⇒ All or Nothing
- Consistency(일관성)
    - 트랜잭션 수행 전과, 수행 후의 상태가 같아야 한다.
- Isolation(독립성)
    - 둘 이상의 트랜잭션이 동시에 병행 실행되는 경우, 어느 하나의 트랜잭션 실행 중에 다른 트랜잭션이 연산에 끼어들 수 없다.
- Durability(영속성)
    - 성공적으로 완료된 트랜잭션의 결과는 영구적으로 반영되어야 한다.

<br/>

<br/>

### 용어 정리

> `Commit`
> 

하나의 트랜잭션이 성공적으로 끝났고, DB가 일관성있는 상태일 때 이를 알려주기 위해 사용하는 연산

<br/>

<br/>

> `Rollback`
> 

하나의 트랜잭션 처리가 비정상적으로 종료되어 트랜잭션 원자성이 깨진 경우

<br/>

<br/>

> `Dirty Read`
> 

아직 커밋되지 않은 수정중인 데이터를 다른 트랜잭션에서 읽을 수 있도록 허용할 때 발생한다.

→ 데이터를 수정중인 트랜잭션이 롤백하는 경우

<br/>

<br/>

> `Phantom Read`
> 

한 트랜잭션 안에서 첫번째 쿼리 수행 결과와 두번째 쿼리 수행 결과가 다른 것을 나타낸다.

→ 동시에 실행중인 트랜잭션의 INSERT 작업에 의해 발생하는 현상을 말한다.

<br/>

<br/>

### 트랜잭션 격리 수준

트랜잭션은 격리 레벨을 어떻게 설정하느냐에 따라 읽기 일관성이 달라진다! = *조회 결과가 달라질 수 있다!*

<br/>

**레벨 0 : Read Uncommitted**

- 트랜잭션에서 처리 중인, 아직 커밋되지 않은 데이터를 다른 트랜잭션에서 읽는 것을 허용
- `Dirty Read`, `Non-Repeatable Read` , `Phantom Read` 현상이 발생한다.

<br/>

<br/>

**레벨 1 : Read Committed**

- 트랜잭션이 커밋되어 확정된 데이터를 읽는 것을 허용한다. → `Dirty Read` 를 방지!
- `Non-Repeatable Read` , `Phantom Read` 현상은 여전히 발생한다.

<br/>

<br/>

**레벨 2 : Repeatable Read**

- 선형 트랜잭션이 읽은 데이터는 트랜잭션이 종료될 때까지 후행 트랜잭션이 `갱신하거나 삭제하는 것을 불허함` → 같은 데이터를 두 번 쿼리했을 때 일관성있는 결과를 리턴한다!
- `Phantom Read` 현상은 여전히 발생한다.

<br/>

<br/>

**레벨 3 : Serializable Read**

- 선형 트랜잭션이 읽은 데이터를 후행 트랜잭션이 갱신하거나 삭제하지 못할 뿐만 아니라 중간에 새로운 레코드를 삽입하는 것도 막아준다. → 완벽하게 읽기 일관성 모드를 제공한다.

<br/>

<br/>

> 트랜잭션 격리 수준을 설정할 때 발생하는 문제점들
> 

<img src="https://github.com/2dongyeop/TIL/blob/main/Database/image/transaction1.png" width = 500/>

- `Read Uncommitted` > `Read Committed` > `Repeatable Read` > `Serializable Read`
    - `ReadUncommitted` 로 갈 수록 동시성은 높아지고, 일관성은 떨어진다.
    - `Serializable Read` 로 갈 수록 동시성은 떨어지고, 일관성은 높아진다.
    - *→ 트랜잭션의 격리 수준은 **일관성** 및 **동시성**과 연관이 있다는 것을 인지하자!*


<br/>

<br/>
